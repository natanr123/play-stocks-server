"use strict";
import AlphaVantageService from 'app/service/AlphaVantageService';
import AlphaVantageServiceStub from 'test/stubs/AlphaVantageServiceStub';

import StocksSymbols from 'app/service/StocksSymbols';
import assert from 'assert';
import sinon from 'sinon';

process.on('unhandledRejection', error => {
    // Won't execute
    console.log('unhandledRejection22222', error);
    throw error;
});

//
describe('AlphaVantageService', function() {
    /// AlphaVantageServiceStub.start();
    this.timeout(2000);

    it('_info_helper should return 100 results using callback', (done)=>
    {
        AlphaVantageService._info_helper(StocksSymbols.MSFT,(response)=>{
            let timeSeries = response['Time Series (1min)'];
            let arr = Object.values(timeSeries);
            assert.equal(arr.length, 100);
            done();
        })
    });

    // it('_info_helper should return 100 Exception', (done)=>
    // {
    //     AlphaVantageService.BASE_URL = 'adasdasd';
    //     AlphaVantageService._info_helper(StocksSymbols.MSFT,(response)=>{
    //         console.log('response: ',response);
    //         let timeSeries = response['Time Series (1min)'];
    //         let arr = Object.values(timeSeries);
    //         assert.equal(arr.length, 100);
    //         done();
    //     });
    //     AlphaVantageService.BASE_URL =  'https://www.alphavantage.co';
    // });

    it('info should return 100 results (100 minutes)', (done)=>
    {
        AlphaVantageService.info(StocksSymbols.MSFT).then((response)=> {

            //console.log(response);
            let timeSeries = response['Time Series (1min)'];
            if( (timeSeries === null) || (timeSeries === undefined) ) {
                console.log('timeSeries is null: ');
                console.log(response);
            }
            let arr = Object.values(timeSeries);
            assert.equal(arr.length, 100);
            done();
        });
    });


});

