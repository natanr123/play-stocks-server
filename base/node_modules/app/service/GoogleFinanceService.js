import AjaxUtils from 'app/service/AjaxUtils';

export default class GoogleFinanceService
{
    static info(symbol)
    {
        console.log('Calling GoogleFinanceService info: ',symbol);
        //YHOO
        return new Promise((resolve, reject)=>{

            GoogleFinanceService._info_helper(symbol,(obj)=>{
                resolve(obj);
            })
        }).catch((error)=>{
            console.log('Error GoogleFinanceService info: ',error);
            throw error;
        });
    }


    static _info_helper(symbol,callback)
    {
        let url = 'http://finance.google.com/finance/info?client=ig&q=NASDAQ%3A';
        url += symbol;
        let  responseForError = '';
        AjaxUtils.loadText(url).then((response)=>{
            responseForError = response;
            response = response.replace('//','');
            response = response.replace('[','');
            response = response.replace(']','');
            //console.log('response: ',response);

            let obj = JSON.parse(response);
            //console.log(obj);
            callback(obj);
        }).catch((error)=>{
            console.log('Error GoogleFinanceService _info_helper: ',error);
            console.log('responseForError: ',responseForError);
            console.log('url: ',url);
            throw error;
        });
    }
}