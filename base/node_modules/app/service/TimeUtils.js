import MomentTimezone from 'moment-timezone'
import Config from 'app/config/Config'

export default class TimeUtils
{

    static timeNowUtc():Number
    {
        if(Config.env().fakeTimeNowUtc) {
            //return 1507730529.3248274;
        }
        return Date.now()/1000;
    }

    static now_formatted()
    {
        let d = new Date();
        let formatted = [d.getFullYear(),
                d.getMonth()+1,d.getDate()].join('-')+' '+
                [d.getHours(),
                    d.getMinutes(),
                    d.getSeconds()].join(':');
        return formatted;
    }

    static formatted(d)
    {
        let formatted = [d.getFullYear(),
                d.getMonth()+1,d.getDate()].join('-')+' '+
            [d.getHours(),
                d.getMinutes(),
                d.getSeconds()].join(':');
        return formatted;
    }

    static formattedUTC(d:Date)
    {
        let formatted = [d.getUTCFullYear(),
                d.getUTCMonth()+1,d.getUTCDate()].join('-')+' '+
            [d.getUTCHours(),
                d.getUTCMinutes(),
                d.getUTCSeconds()].join(':');
        return formatted;
    }

    static timeInNewYork(date)
    {
        let jun = MomentTimezone(date);
        let t = jun.tz('America/New_York').format('YYYY-MM-DD HH:mm:ss');
        return t;
    }

    static dayInNewYork()
    {
        let jun = MomentTimezone(Date.now());
        let t = jun.tz('America/New_York').day();
        return t;
    }

    static hourInNewYork()
    {
        // 6 saturday 5 friday 4 thursday 3 wednesday 2 tuesday 1 monday 0 sunday
        let jun = MomentTimezone(Date.now());
        let t = jun.tz('America/New_York').hour();
        return t;
    }

    static minuteInNewYork()
    {
        // 6 saturday 5 friday 4 thursday 3 wednesday 2 tuesday 1 monday 0 sunday
        let jun = MomentTimezone(Date.now());
        let t = jun.tz('America/New_York').minute();
        // return t;
        return true;
    }

    static isNYSEopen() {
        if(Config.env().nyseAlwaysOpen) {
            return true;
        }
        if (!(TimeUtils.dayInNewYork() >= 1 && TimeUtils.dayInNewYork() <= 5)) {
            return false;
        }

        let nowMinutes = TimeUtils.hourInNewYork() * 60 + TimeUtils.minuteInNewYork();
        let margin = 5;
        let startMinute = 9 * 60 + 30 + margin;
        let endMinute = 16 * 60 - margin;
        return (nowMinutes >= startMinute && nowMinutes <= endMinute);
    }

    static newYorkToTime(timeStr)
    {
        // https://stackoverflow.com/questions/18448347/how-to-create-time-in-a-specific-time-zone-with-moment-js

        let newYork = MomentTimezone.tz(timeStr,'YYYY-MM-DD HH:mm:ss','America/New_York');
        return newYork.toDate().getTime()/1000;
    }
}